<html>
  <head>
    <style>
      body {
        white-space: pre;
        font-family: courier;
        font-weight: bold;
      }
      .def {
        color: blue;
        font-weight: bold;
      }
      .lambda {
        color: red;
        font-weight: bold;
      }
      .dot {
        color: black;
        font-weight: bold;
        font-size: 24px;
      }
    </style>
  </head>
<body><span class='def'>t   =</span> <span class='lambda'>λ</span>x y <span class='dot'>.</span> x
<span class='def'>f   =</span> <span class='lambda'>λ</span>x y <span class='dot'>.</span> y
<span class='def'>not =</span> <span class='lambda'>λ</span>a <span class='dot'>.</span> a f t
<span class='def'>e      =</span> <span class='lambda'>λ</span>0 1 2 3 4 <span class='dot'>.</span> 0
<span class='def'>s      =</span> <span class='lambda'>λ</span>0 1 2 3 4 <span class='dot'>.</span> 1
<span class='def'>a1     =</span> <span class='lambda'>λ</span>0 1 2 3 4 <span class='dot'>.</span> 2
<span class='def'>a2     =</span> <span class='lambda'>λ</span>0 1 2 3 4 <span class='dot'>.</span> 3
<span class='def'>m      =</span> <span class='lambda'>λ</span>0 1 2 3 4 <span class='dot'>.</span> 4
<span class='def'>cell   =</span> <span class='lambda'>λ</span>n f <span class='dot'>.</span> f n
<span class='def'>isE    =</span> <span class='lambda'>λ</span>n <span class='dot'>.</span> n t f f f f
<span class='def'>larger =</span> <span class='lambda'>λ</span>n1 n2 <span class='dot'>.</span> n1 n2 (n2 n1 n1 n2 n2 n2) (n2 n1 n1 n1 n2 n2) (n2 n1 n1 n1 n1 n2) n1
<span class='def'>row   =</span> <span class='lambda'>λ</span>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 r <span class='dot'>.</span> r 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19
<span class='def'>left  =</span> <span class='lambda'>λ</span>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 r <span class='dot'>.</span> r 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 1
<span class='def'>right =</span> <span class='lambda'>λ</span>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 r <span class='dot'>.</span> r 19 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18
<span class='def'>cellA =</span> <span class='lambda'>λ</span>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <span class='dot'>.</span> cell 1
<span class='def'>cellZ =</span> <span class='lambda'>λ</span>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <span class='dot'>.</span> cell 19
<span class='def'>get1  =</span> <span class='lambda'>λ</span>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <span class='dot'>.</span> 1
<span class='def'>row-to-func   =</span> <span class='lambda'>λ</span>g 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 r <span class='dot'>.</span> r (1 g) (2 g) (3 g) (4 g) (5 g) (6 g) (7 g) (8 g) (9 g) (10 g) (11 g) (12 g) (13 g) (14 g) (15 g) (16 g) (17 g) (18 g) (19 g)
<span class='def'>func-to-row =</span> <span class='lambda'>λ</span>g 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 r <span class='dot'>.</span> r (g 1) (g 2) (g 3) (g 4) (g 5) (g 6) (g 7) (g 8) (g 9) (g 10) (g 11) (g 12) (g 13) (g 14) (g 15) (g 16) (g 17) (g 18) (g 19)
<span class='def'>rowReduce =</span> <span class='lambda'>λ</span>first g last 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <span class='dot'>.</span> 1 first g 2 g 3 g 4 g 5 g 6 g 7 g 8 g 9 g 10 g 11 g 12 g 13 g 14 g 15 g 16 g 17 g 18 g 19 last
<span class='def'>empty     =</span> row e e e e e e e e e e e e e e e e e e e
<span class='def'>arow1     =</span> row e e e e e a1 e a1 e a1 e a1 e a1 e e e e e
<span class='def'>gridStart =</span> row arow1 empty arow1 empty arow1 empty arow1 empty empty empty empty empty empty empty empty empty empty empty empty
<span class='def'>shipStart =</span> row e e e e e e e e e s e e e e e e e e e
<span class='def'>identity  =</span> <span class='lambda'>λ</span>x <span class='dot'>.</span> x
<span class='def'>ignore    =</span> <span class='lambda'>λ</span>x <span class='dot'>.</span> ign
<span class='def'>onFirstEmpty    =</span> <span class='lambda'>λ</span>1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 <span class='dot'>.</span> 1 identity ignore ignore ignore ignore
<span class='def'>check1    =</span> <span class='lambda'>λ</span>n r <span class='dot'>.</span> r <span class='lambda'>λ</span>m1 m2 m3 m4 m5 m6 m7 m8 m9 m10 m11 m12 m13 m14 m15 m16 m17 m18 m19 <span class='dot'>.</span> cell (n m1 n n n n)
<span class='def'>check19   =</span> <span class='lambda'>λ</span>n r <span class='dot'>.</span> r <span class='lambda'>λ</span>m1 m2 m3 m4 m5 m6 m7 m8 m9 m10 m11 m12 m13 m14 m15 m16 m17 m18 m19 <span class='dot'>.</span> cell (n m19 n n n n)
<span class='def'>isAllFirstEmpty =</span> rowReduce cellA check1 isE
<span class='def'>isAllLastEmpty  =</span> rowReduce cellZ check19 isE
<span class='def'>allLeft   =</span> row-to-func left
<span class='def'>allRight  =</span> row-to-func right
<span class='def'>counter =</span> <span class='lambda'>λ</span>1 2 3 4 5 6 7 8 9 10 11 12 c <span class='dot'>.</span> c 1 2 3 4 5 6 7 8 9 10 11 12
<span class='def'>cNext   =</span> <span class='lambda'>λ</span>1 2 3 4 5 6 7 8 9 10 11 12 c <span class='dot'>.</span> c 2 3 4 5 6 7 8 9 10 11 12 1
<span class='def'>cTrue   =</span> <span class='lambda'>λ</span>1 2 3 4 5 6 7 8 9 10 11 12 <span class='dot'>.</span> 1
<span class='def'>fastest =</span> counter t f t f t f t f t f t f
<span class='def'>fast    =</span> counter t f f t f f t f f t f f
<span class='def'>normal  =</span> counter t f f f t f f f t f f f
<span class='def'>slow    =</span> counter t f f f f f t f f f f f
<span class='def'>slowest =</span> counter t f f f f f f f f f f f
<span class='def'>cflip    =</span> <span class='lambda'>λ</span>n <span class='dot'>.</span> n e s a2 a1 m
<span class='def'>flip     =</span> func-to-row cflip
<span class='def'>allFlip  =</span> row-to-func flip
<span class='def'>start    =</span> <span class='lambda'>λ</span>statef <span class='dot'>.</span> statef gridStart shipStart t slowest
<span class='def'>checkDir =</span> <span class='lambda'>λ</span>grid left? <span class='dot'>.</span> left? (grid isAllFirstEmpty) (not (grid isAllLastEmpty))
<span class='def'>next     =</span> <span class='lambda'>λ</span>grid ship left? ctr statef <span class='dot'>.</span> (<span class='lambda'>λ</span>dir <span class='dot'>.</span> statef (ctr cTrue (grid (dir allLeft allRight) allFlip) grid) ship dir (ctr cNext)) (checkDir grid left?)
<span class='def'>moveLeft  =</span> <span class='lambda'>λ</span>grid ship left? ctr <span class='dot'>.</span> next grid (ship (ship onFirstEmpty left)) left? ctr
<span class='def'>moveRight =</span> <span class='lambda'>λ</span>grid ship left? ctr <span class='dot'>.</span> next grid (ship (ship right onFirstEmpty right)) left? ctr
<span class='def'>stay      =</span> <span class='lambda'>λ</span>grid ship left? ctr <span class='dot'>.</span> next grid ship left? ctr</body>
</html>
