#+TITLE: Concurrent Operations With the Google Realtime API
* The first collaborator is the "tie-breaker"
It processes requests from collaborators
* Requests (JSON objects)
** cmd: '_reserve', resourceName: name, duration: "long" or "short", resources: [block/headline names]
** cmd: '_release', resourceName: name
** cmd: '_increment', block: blockName, counter: counterName -- response contains resulting value
** cmd: '_set', block: blockName, counter: counterName, oldValue: v  -- response contains success or failure
** cmd: '_slideValue', block: blockName, line: lineNum, index: numberIndex, delta: deltaAmount
** cmd: OTHER (no underscore), ... (custom command)
* Reservation requests (shared blocks and headlines)
Shared blocks and headlines have the "shared" property set to true. The editor
will refuse to edit these sections; they can only be changed programmatically
** Reservation requests may be "long" or "short"
*** long requests wait in the queue until granted
*** short requests are either granted or rejected immediately
* Releasing
** A collaborator releases a resource it owns by setting the "owner" field to null
* Increment requests (shared counters)
Collaborators may request incrementing a counter in a shared data block
* Set requests (setting shared values)
Collaborators
* Value sliding
** Send increment command to change the value
** Use the Nth numeric value on a line for increments
* The Requests List
** A CollaboartiveList of requests
** Collaborators add requests to the list
** The tie-breaker processes the requests
1. processes all of the requests
2. removes all of the requests it processed
* The Resources Map (map of resource name -> info)
** __TIE_BREAKER__ -> the collaborator ID of the current tie breaker
*** A new tie breaker is chosen after the current one disconnects
** resource name -> info
*** reserved blocks resource
**** type: "blocks"
**** owner: current owner
**** Blocks/headlines
*** counter resource
**** type: "counter"
**** value: number
* Reserved blocks (map of block/headline -> resource name)
* Counter Information
** type: counter
** owner: current owner
** value: current value
