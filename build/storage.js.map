{
  "version": 3,
  "file": "storage.js",
  "sourceRoot": "..",
  "sources": [
    "src/storage.litcoffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "Lounge browser storage. Load and save documents to lounge storage. Saved\ndocuments will checkpoint as you type.\n\n    'use strict'\n    define ['./org', './docOrg', './utilities', './db', './editorSupport'], (Org, DocOrg, Utilites, EditorSupport)->\n      {\n        parseOrgDoc\n      } = EditorSupport\n\n      clearIndices = true\n\n      initStorage = ->\n\n      storeNameFor = (docName)-> \"@local #{docName}\"\n\n      getDocument = (docName)->\n        t = transaction storeNameFor(docName), 'readonly'\n        blocks = null\n        t.getAll('ids').then (rawBlocks)->\n          blocks = _.keyBy rawBlocks, '_id'\n          t.get('first').then (first)-> {\n            first\n            blocks\n          }\n\n      storeDocument = (data, docName, first, blocks)->\n        if !blocks\n          blocks = parseOrgMode first\n          first =  blocks[0]._id\n          sets = _.keyBy blocks, '_id'\n          data.linkAllSiblings {first, sets}\n        transaction(storeNameFor docName).then (t)->\n          if clearIndices\n            for index in t.store.indexNames\n              store.deleteIndex index\n          if !store.indexNames.length\n            store.createIndex 'ids', '_id', unique: true\n            store.createIndex 'names', 'codeName'\n          t.put first, 'first'\n          for block in blocks\n            t.put block, block._id\n          null\n\n      class LocalDoc\n        constructor: (data)->\n          @storeName = storeNameFor data.baseDocName\n          data.addFilter\n        transaction: (type)-> transaction @storeName, type\n        replaceBlock: (data, oldBlock, newBlock, context)->\n          @transaction().put newBlock, newBlock._id\n        clear: (data)=> @transaction().clear()\n\n      {\n        initStorage\n      }\n"
  ]
}