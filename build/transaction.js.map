{
  "version": 3,
  "file": "transaction.js",
  "sourceRoot": "..",
  "sources": [
    "src/transaction.litcoffee"
  ],
  "names": [],
  "mappings": ";AAAA;EAAA;EAEI;EACA,MAAA,CAAO,CAAC,QAAD,EAAW,OAAX,EAAoB,UAApB,EAAgC,QAAhC,EAA0C,UAA1C,EAAsD,UAAtD,CAAP,EAA0E,QAAA,CAAC,IAAD,EAAO,GAAP,EAAY,MAAZ,EAAoB,CAApB,EAAuB,MAAvB,EAA+B,QAA/B,CAAA;AACxE,QAAA,QAAA,EAAA,aAAA,EAAA,YAAA,EAAA,KAAA,EAAA,cAAA,EAAA;IAAA,CAAA,CACE,YADF,CAAA,GAEI,MAFJ;IAGA,CAAA,CACE,QADF,CAAA,GAEI,QAFJ;IAIA,KAAA,GAAQ;IAEF;MAAN,MAAA,cAAA;QACE,WAAa,MAAA,CAAA;UAAC,IAAC,CAAA;UACb,IAAC,CAAA,QAAD,GAAY,CAAA;UACZ,IAAC,CAAA,QAAD,GAAY,CAAA;UACZ,IAAC,CAAA,GAAD,GAAO,CAAA;UACP,IAAC,CAAA,OAAD,GAAW,CAAA;UACX,IAAG,CAAC,KAAJ;YAAe,KAAA,GAAQ,OAAO,CAAC,MAA/B;;QALW;;QAMb,KAAO,CAAA,CAAA;UACL,YAAA,CAAa,IAAC,CAAA,IAAd,EAAoB,IAApB,EAA0B,IAAC,CAAA,MAA3B;iBACA;QAFK;;QAGP,IAAM,CAAA,CAAA;UACJ,YAAA,CAAa,IAAC,CAAA,IAAd,EAAoB,KAApB,EAA2B,IAAC,CAAA,MAA5B;iBACA;QAFI;;MAVR;;8BAaE,MAAA,GACE;QAAA,QAAA,EAAU;UAAA,aAAA,EAAe,QAAA,CAAC,MAAD,CAAA;mBAAW,QAAA,CAAC,KAAD,EAAQ,OAAR,CAAA;cAClC,aAAa,CAAC,QAAS,CAAA,KAAA,CAAM,KAAN,CAAA,CAAvB,GAAsC;qBACtC,MAAA,CAAO,KAAP,EAAc,OAAd;YAFkC;UAAX;QAAf,CAAV;QAGA,QAAA,EAAU;UAAA,aAAA,EAAe,QAAA,CAAC,MAAD,CAAA;mBAAW,QAAA,CAAC,EAAD,EAAK,KAAL,CAAA;cAClC,EAAA,GAAK,KAAA,CAAM,EAAN;cACL,aAAa,CAAC,GAAI,CAAA,EAAA,CAAlB,GAAwB;cACxB,IAAG,CAAC,aAAa,CAAC,QAAS,CAAA,EAAA,CAA3B;gBAAoC,aAAa,CAAC,QAAS,CAAA,EAAA,CAAvB,GAA6B,IAAC,CAAA,QAAD,CAAU,EAAV,EAAjE;;qBACA,MAAA,CAAO,EAAP,EAAW,KAAX;YAJkC;UAAX;QAAf,CAHV;QAQA,WAAA,EAAa;UAAA,aAAA,EAAe,QAAA,CAAC,MAAD,CAAA;mBAAW,QAAA,CAAC,EAAD,CAAA;cACrC,aAAa,CAAC,OAAQ,CAAA,EAAA,CAAtB,GAA4B;cAC5B,IAAG,CAAC,aAAa,CAAC,QAAS,CAAA,EAAA,CAA3B;gBAAoC,aAAa,CAAC,QAAS,CAAA,EAAA,CAAvB,GAA6B,IAAC,CAAA,QAAD,CAAU,EAAV,EAAjE;;qBACA,MAAA,CAAO,EAAP;YAHqC;UAAX;QAAf;MARb;;;;;IAaJ,cAAA,GAAiB,QAAA,CAAC,IAAD,CAAA;aAAS,IAAI,aAAJ,CAAkB,IAAlB,CAAuB,CAAC,KAAxB,CAAA;IAAT;IAEjB,mBAAA,GAAsB,QAAA,CAAC,IAAD,EAAO,IAAP,CAAA;AACpB,UAAA;MAAA,GAAA,GAAM,cAAA,CAAe,IAAf;AACN;eACE,IAAA,CAAA,EADF;OAAA;QAGE,GAAG,CAAC,IAAJ,CAAA,EAHF;;IAFoB;WAOtB,CACE,cADF,EAEE,mBAFF;EA9CwE,CAA1E;AAHJ",
  "sourcesContent": [
    "Note data accesses and changes.\n\n    'use strict'\n    define ['./base', './org', './docOrg', 'lodash', './advice', 'bluebird'], (Base, Org, DocOrg, _, Advice, Bluebird)->\n      {\n        changeAdvice\n      } = Advice\n      {\n        BPromise\n      } = Bluebird\n\n      getId = null\n\n      class ChangeMonitor\n        constructor: (@data)->\n          @accessed = {}\n          @original = {}\n          @set = {}\n          @deleted = {}\n          if !getId then getId = Leisure.getId\n        start: ->\n          changeAdvice @data, true, @advice\n          this\n        stop: ->\n          changeAdvice @data, false, @advice\n          this\n        advice:\n          getBlock: changeMonitor: (parent)-> (thing, changes)->\n            changeMonitor.accessed[getId thing] = true\n            parent thing, changes\n          setBlock: changeMonitor: (parent)-> (id, block)->\n            id = getId id\n            changeMonitor.set[id] = true\n            if !changeMonitor.original[id] then changeMonitor.original[id] = @getBlock id\n            parent id, block\n          deleteBlock: changeMonitor: (parent)-> (id)->\n            changeMonitor.deleted[id] = true\n            if !changeMonitor.original[id] then changeMonitor.original[id] = @getBlock id\n            parent id\n\n      monitorChanges = (data)-> new ChangeMonitor(data).start()\n\n      monitorChangesWhile = (data, func)->\n        mon = monitorChanges data\n        try\n          func()\n        finally\n          mon.stop()\n\n      {\n        monitorChanges\n        monitorChangesWhile\n      }\n"
  ]
}