// Generated by CoffeeScript 1.12.4
(function() {
  var extend = function(child, parent) { for (var key in parent) { if (hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    hasProp = {}.hasOwnProperty;

  define(['./server', './guarded-operation'], function(OT) {
    var GuardedOperation, GuardedServer, RejectGuardedOperation, Server, conflictsWith, guardedTransform;
    Server = OT.Server, GuardedOperation = OT.GuardedOperation, conflictsWith = OT.conflictsWith, guardedTransform = OT.guardedTransform, RejectGuardedOperation = OT.RejectGuardedOperation;
    GuardedServer = (function(superClass) {
      extend(GuardedServer, superClass);

      function GuardedServer(document, operations) {
        GuardedServer.__super__.constructor.call(this, document, operations);
      }

      GuardedServer.prototype.receiveGuardedOperation = function(revision, operation, guards) {
        var conOp, concurrentOperations, i, len;
        operation = new GuardedOperation(operation, guards);
        concurrentOperations = this.operations.slice(revision);
        for (i = 0, len = concurrentOperations.length; i < len; i++) {
          conOp = concurrentOperations[i];
          if (operation.conflictsWith(conOp)) {
            return RejectGuardedOperation;
          }
          operation = opertion.transform(conOp);
        }
        operation = operation.original;
        this.document = operation.apply(this.document);
        this.operations.push(operation);
        return operation;
      };

      return GuardedServer;

    })(Server);
    OT.GuardedServer = GuardedServer;
    return OT;
  });

}).call(this);

//# sourceMappingURL=guarded-server.js.map
